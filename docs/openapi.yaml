openapi: 3.1.0
info:
  title: Investor Dash API
  version: 1.0.0
  description: API for journals, instruments, trades, closures, notes, attachments, routines and finviz reports.
servers:
  - url: http://127.0.0.1:3001

tags:
  - name: System
  - name: Journals
  - name: Instruments
  - name: Accounts
  - name: Trades
  - name: Trade Closures
  - name: Trade Notes
  - name: Attachments
  - name: Routines
  - name: Finviz

paths:
  /api/health:
    get:
      tags: [System]
      summary: API health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/journals:
    get:
      tags: [Journals]
      summary: List journals
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Journal'
    post:
      tags: [Journals]
      summary: Create journal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJournalRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Journal'

  /api/journals/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Journals]
      summary: Get journal
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Journal'
    put:
      tags: [Journals]
      summary: Update journal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateJournalRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Journal'
    delete:
      tags: [Journals]
      summary: Delete/archive journal
      responses:
        '204':
          description: No Content

  /api/instruments:
    get:
      tags: [Instruments]
      summary: List instruments by journal
      parameters:
        - $ref: '#/components/parameters/JournalIdQuery'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Instrument'
    post:
      tags: [Instruments]
      summary: Create instrument
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInstrumentRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instrument'

  /api/instruments/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Instruments]
      summary: Get instrument
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instrument'
    put:
      tags: [Instruments]
      summary: Update instrument
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateInstrumentRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instrument'
    delete:
      tags: [Instruments]
      summary: Delete instrument
      responses:
        '204':
          description: No Content

  /api/accounts:
    get:
      tags: [Accounts]
      summary: List accounts by journal
      parameters:
        - $ref: '#/components/parameters/JournalIdQuery'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Account'
    post:
      tags: [Accounts]
      summary: Create account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'

  /api/accounts/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Accounts]
      summary: Get account
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
    put:
      tags: [Accounts]
      summary: Update account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAccountRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
    delete:
      tags: [Accounts]
      summary: Delete account
      responses:
        '204':
          description: No Content

  /api/trades:
    get:
      tags: [Trades]
      summary: List trades by journal
      parameters:
        - $ref: '#/components/parameters/JournalIdQuery'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Trade'
    post:
      tags: [Trades]
      summary: Create trade
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTradeRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trade'

  /api/trades/stats:
    get:
      tags: [Trades]
      summary: Get trade stats by journal
      parameters:
        - $ref: '#/components/parameters/JournalIdQuery'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeStats'

  /api/trades/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Trades]
      summary: Get trade
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trade'
    put:
      tags: [Trades]
      summary: Update trade
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTradeRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trade'
    delete:
      tags: [Trades]
      summary: Delete trade
      responses:
        '204':
          description: No Content

  /api/trades/{id}/closures:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Trade Closures]
      summary: List closures for trade
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TradeClosure'
    post:
      tags: [Trade Closures]
      summary: Add closure event (partial/full)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTradeClosureRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeClosure'

  /api/trade-closures/{closureId}:
    parameters:
      - name: closureId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags: [Trade Closures]
      summary: Update closure event
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTradeClosureRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeClosure'
    delete:
      tags: [Trade Closures]
      summary: Delete closure event
      responses:
        '204':
          description: No Content

  /api/trades/{id}/notes:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Trade Notes]
      summary: List notes for trade
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TradeNote'
    post:
      tags: [Trade Notes]
      summary: Create note
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTradeNoteRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeNote'

  /api/trade-notes/{noteId}:
    parameters:
      - name: noteId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags: [Trade Notes]
      summary: Update note
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTradeNoteRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeNote'
    delete:
      tags: [Trade Notes]
      summary: Delete note
      responses:
        '204':
          description: No Content

  /api/trade-notes/{noteId}/attachments:
    parameters:
      - name: noteId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      tags: [Attachments]
      summary: Upload screenshot attachment
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Attachment'

  /api/note-attachments/{attachmentId}:
    parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    delete:
      tags: [Attachments]
      summary: Delete attachment
      responses:
        '204':
          description: No Content

  /api/note-attachments/{attachmentId}/url:
    parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Attachments]
      summary: Get signed/private URL
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    format: uri
                required: [url]

  /api/routines/today:
    get:
      tags: [Routines]
      summary: Get today's routine
      responses:
        '200':
          description: OK

  /api/routines:
    post:
      tags: [Routines]
      summary: Create or update routine
      responses:
        '200':
          description: OK

  /api/routines/streak:
    get:
      tags: [Routines]
      summary: Get routine streak
      responses:
        '200':
          description: OK

  /api/finviz:
    get:
      tags: [Finviz]
      summary: List finviz reports
      responses:
        '200':
          description: OK
    post:
      tags: [Finviz]
      summary: Upload finviz report
      responses:
        '201':
          description: Created

  /api/finviz/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPath'
    get:
      tags: [Finviz]
      summary: Get finviz report
      responses:
        '200':
          description: OK

components:
  parameters:
    IdPath:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    JournalIdQuery:
      name: journalId
      in: query
      required: true
      schema:
        type: string
        format: uuid

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [ok]
        service:
          type: string
          enum: [api]
        timestamp:
          type: string
          format: date-time
        uptime:
          type: number
      required: [status, service, timestamp, uptime]

    Journal:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        broker: { type: string }
        baseCurrency: { type: string }
        timezone: { type: string }
      required: [id, name]

    CreateJournalRequest:
      type: object
      properties:
        name: { type: string }
        broker: { type: string }
        baseCurrency: { type: string }
        timezone: { type: string }
      required: [name]

    UpdateJournalRequest:
      allOf:
        - $ref: '#/components/schemas/CreateJournalRequest'

    Instrument:
      type: object
      properties:
        id: { type: string, format: uuid }
        journalId: { type: string, format: uuid }
        ticker: { type: string }
        symbol: { type: string }
        instrumentType: { type: string }
        defaultLeverage: { type: number }
        minLot: { type: number }
        lotStep: { type: number }
        marketTimezone: { type: string }
        sessionOpenTime: { type: string, pattern: '^\\d{2}:\\d{2}(:\\d{2})?$' }
        sessionCloseTime: { type: string, pattern: '^\\d{2}:\\d{2}(:\\d{2})?$' }
      required: [id, journalId, ticker, instrumentType, defaultLeverage, minLot, lotStep, marketTimezone, sessionOpenTime, sessionCloseTime]

    CreateInstrumentRequest:
      type: object
      properties:
        journalId: { type: string, format: uuid }
        ticker: { type: string }
        symbol: { type: string }
        instrumentType: { type: string }
        defaultLeverage: { type: number }
        minLot: { type: number }
        lotStep: { type: number }
        marketTimezone: { type: string }
        sessionOpenTime: { type: string }
        sessionCloseTime: { type: string }
      required: [journalId, ticker, instrumentType, defaultLeverage, minLot, lotStep, marketTimezone, sessionOpenTime, sessionCloseTime]

    UpdateInstrumentRequest:
      allOf:
        - $ref: '#/components/schemas/CreateInstrumentRequest'

    Account:
      type: object
      properties:
        id: { type: string, format: uuid }
        journalId: { type: string, format: uuid }
        name: { type: string }
        currency: { type: string }
      required: [id, journalId, name]

    CreateAccountRequest:
      type: object
      properties:
        journalId: { type: string, format: uuid }
        name: { type: string }
        currency: { type: string }
      required: [journalId, name]

    UpdateAccountRequest:
      allOf:
        - $ref: '#/components/schemas/CreateAccountRequest'

    Trade:
      type: object
      properties:
        id: { type: string, format: uuid }
        accountId: { type: string, format: uuid }
        instrumentId: { type: string, format: uuid }
        direction:
          type: string
          enum: [Long, Short]
        status:
          type: string
          enum: [open, partial, closed]
        entryPrice: { type: number }
        slPrice: { type: number }
        tpPrice: { type: number }
        positionSize: { type: number }
        remainingSize: { type: number }
        realizedPnlAmount: { type: number }
      required: [id, accountId, direction, status, entryPrice, slPrice, tpPrice, positionSize, remainingSize]

    CreateTradeRequest:
      type: object
      properties:
        accountId: { type: string, format: uuid }
        instrumentId: { type: string, format: uuid }
        direction:
          type: string
          enum: [Long, Short]
        entryPrice: { type: number }
        slPrice: { type: number }
        tpPrice: { type: number }
        positionSize: { type: number }
      required: [accountId, direction, entryPrice, slPrice, tpPrice, positionSize]

    UpdateTradeRequest:
      allOf:
        - $ref: '#/components/schemas/CreateTradeRequest'

    TradeClosure:
      type: object
      properties:
        id: { type: string, format: uuid }
        tradeId: { type: string, format: uuid }
        closedSize: { type: number }
        exitPrice: { type: number }
        pnlAmount: { type: number }
        reason: { type: string }
      required: [id, tradeId, closedSize, exitPrice, pnlAmount]

    CreateTradeClosureRequest:
      type: object
      properties:
        closedSize: { type: number }
        exitPrice: { type: number }
        reason: { type: string }
        note: { type: string }
      required: [closedSize, exitPrice]

    UpdateTradeClosureRequest:
      allOf:
        - $ref: '#/components/schemas/CreateTradeClosureRequest'

    TradeNote:
      type: object
      properties:
        id: { type: string, format: uuid }
        tradeId: { type: string, format: uuid }
        noteType:
          type: string
          enum: [pre, during, post, closure]
        content: { type: string }
      required: [id, tradeId, noteType, content]

    CreateTradeNoteRequest:
      type: object
      properties:
        noteType:
          type: string
          enum: [pre, during, post, closure]
        content: { type: string }
      required: [noteType, content]

    UpdateTradeNoteRequest:
      allOf:
        - $ref: '#/components/schemas/CreateTradeNoteRequest'

    Attachment:
      type: object
      properties:
        id: { type: string, format: uuid }
        noteId: { type: string, format: uuid }
        fileName: { type: string }
        storagePath: { type: string }
        mimeType: { type: string }
        sizeBytes: { type: integer }
      required: [id, noteId, fileName, storagePath, mimeType, sizeBytes]

    TradeStats:
      type: object
      properties:
        winRate: { type: number }
        profitFactor: { type: number }
        expectancy: { type: number }
        realizedPnl: { type: number }
        unrealizedPnl: { type: number }
